<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Coaching Notes (Live Markdown)</title>

  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1620;
      --panel2:#0c121a;
      --text:#d7e1ee;
      --muted:#8aa0b8;
      --line:#1c2a3a;
      --accent:#6aa6ff;
      --good:#2bd576;
      --warn:#ffcc66;
      --bad:#ff6b6b;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    html,body{height:100%;}
    body{
      margin:0;
      background:linear-gradient(180deg, var(--bg), #070a0e 75%);
      color:var(--text);
      font-family:var(--sans);
    }

    .banner{
      background:rgba(15,22,32,.92);
      border-bottom:1px solid var(--line);
      padding:10px 14px;
      font-size:14px;
      color:var(--muted);
      position:sticky;
      top:0;
      z-index:5;
    }
    .banner strong{color:var(--text);}

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:14px;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }

    .title h1{
      margin:0;
      font-size:18px;
    }

    .meta{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
    }

    .status{
      display:flex;
      gap:10px;
      font-family:var(--mono);
      font-size:12px;
    }

    .pill{
      padding:5px 8px;
      border:1px solid var(--line);
      border-radius:999px;
      background:rgba(15,22,32,.7);
    }

    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width:900px){
      .grid{grid-template-columns:1fr;}
    }

    .panel{
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:rgba(15,22,32,.55);
    }

    .panel header{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      background:rgba(12,18,26,.7);
    }

    textarea{
      width:100%;
      height:70vh;
      min-height:420px;
      resize:vertical;
      border:0;
      outline:none;
      background:rgba(15,22,32,.35);
      color:var(--text);
      font-family:var(--mono);
      font-size:14px;
      line-height:1.45;
      padding:12px;
    }

    .preview{
      padding:14px;
      height:70vh;
      min-height:420px;
      overflow:auto;
      background:rgba(12,18,26,.35);
    }

    /* Markdown preview styling */
    .preview h1{font-size:22px;border-bottom:1px solid var(--line);}
    .preview h2{font-size:18px;}
    .preview h3{font-size:15px;}
    .preview p{margin:10px 0;}
    .preview code{
      font-family:var(--mono);
      background:rgba(106,166,255,.1);
      padding:2px 6px;
      border-radius:6px;
    }
    .preview pre{
      background:rgba(15,22,32,.75);
      padding:12px;
      border-radius:10px;
      overflow:auto;
    }
    .preview blockquote{
      border-left:3px solid var(--accent);
      padding-left:10px;
      color:var(--muted);
    }
    .preview ul{margin-left:20px;}

    button{
      border:1px solid var(--line);
      background:rgba(15,22,32,.7);
      color:var(--text);
      font-family:var(--mono);
      font-size:12px;
      padding:6px 10px;
      border-radius:10px;
      cursor:pointer;
    }
    button:hover{border-color:var(--accent);}
  </style>

  <!-- Markdown + sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <script>
    const $ = (id) => document.getElementById(id);

    function qs(name){
      return new URL(location.href).searchParams.get(name);
    }

    function debounce(fn, ms){
      let t;
      return (...args)=>{
        clearTimeout(t);
        t = setTimeout(()=>fn(...args), ms);
      };
    }

    function setStatus(text){
      $("statusText").textContent = text;
    }

    function render(md){
      const html = DOMPurify.sanitize(marked.parse(md || ""));
      $("preview").innerHTML = html;
    }

    const docId = (qs("doc") || "default").trim();
    const storageKey = `coach_notes_${docId}`;

    const save = debounce(()=>{
      const md = $("editor").value;
      localStorage.setItem(storageKey, md);
      render(md);
      $("dirty").textContent = "saved";
      setStatus("Saved (local)");
    }, 200);

    window.addEventListener("DOMContentLoaded", ()=>{
      $("docId").textContent = docId;

      const saved = localStorage.getItem(storageKey);
      if(saved){
        $("editor").value = saved;
        render(saved);
      }

      $("editor").addEventListener("input", ()=>{
        $("dirty").textContent = "typing…";
        save();
      });

      $("btnCopyLink").onclick = async ()=>{
        const u = new URL(location.href);
        if(!u.searchParams.get("doc")) u.searchParams.set("doc", docId);
        await navigator.clipboard.writeText(u.toString());
        setStatus("Link copied");
      };

      $("btnClear").onclick = ()=>{
        if(!confirm("Clear this note?")) return;
        $("editor").value = "";
        render("");
        localStorage.setItem(storageKey, "");
        $("dirty").textContent = "saved";
        setStatus("Cleared");
      };
    });
  </script>
</head>

<body>
  <div class="banner">
    <strong>We win by helping others win.</strong>
    <span style="margin-left:10px;">Live Markdown coaching notes</span>
  </div>

  <div class="wrap">
    <div class="topbar">
      <div class="title">
        <h1>Coaching Notes — <span class="meta">doc:</span> <span id="docId" class="meta"></span></h1>
        <div class="meta">Use <code>?doc=clientName</code> to separate clients</div>
      </div>

      <div class="status">
        <span class="pill">state: <span id="dirty">idle</span></span>
        <span class="pill" id="statusText">Ready</span>
      </div>
    </div>

    <div class="grid">
      <section class="panel">
        <header>
          <span class="meta">EDITOR (.md)</span>
          <div>
            <button id="btnCopyLink">Copy Link</button>
            <button id="btnClear">Clear</button>
          </div>
        </header>
        <textarea id="editor" spellcheck="false"
placeholder="# Session Notes

## Goals
- ...

## Observations
- ...

## Plan
- ...
"></textarea>
      </section>

      <section class="panel">
        <header>
          <span class="meta">LIVE PREVIEW</span>
        </header>
        <div id="preview" class="preview"></div>
      </section>
    </div>
  </div>
</body>
</html>
